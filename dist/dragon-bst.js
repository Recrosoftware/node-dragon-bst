!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.DragonBST=e():t.DragonBST=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,r){"use strict";function i(t){return Math.floor(Math.random()*t)}function n(t){for(var e=[],r=0;r<t;++r)e.push(r);for(var r=e.length-1;r>=0;--r){var n=i(r),o=e[r];e[r]=e[n],e[n]=o}return e}function o(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;throw new l("Couldn't compare elements ('"+t+"'["+typeof t+"] - '"+e+"'["+typeof e+"])",{a:t,b:e})}function a(t,e){return t===e}function h(t,e){for(var r=0,i=e;r<i.length;r++){var n=i[r];t.push(n)}}var u=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var l=function(t){function e(e,r){var i=t.call(this,e)||this;return i.metadata={},null!=r&&Object.keys(r).forEach(function(t){i.metadata[t]=r[t]}),i}return u(e,t),e}(Error);e.TreeError=l,e.gerRandomInteger=i,e.getRandomArray=n,e.defaultCompareKeys=o,e.defaultCheckValueEquality=a,e.append=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(2);e.AVLTree=i.AVLTree;var n=r(0);e.TreeError=n.TreeError},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),n=function(){function t(t){this.avl=new o(t||{})}return t.prototype.validateTree=function(){this.avl.validateTree()},t.prototype.getNumberOfKeys=function(){return this.avl.getNumberOfKeys()},t.prototype.getHeight=function(){return this.avl.getHeight()},t.prototype.insert=function(t,e){if(void 0===t)throw new i.TreeError("Cannot insert an undefined key.");var r=this.avl.insert(t,e);r&&(this.avl=r)},t.prototype.delete=function(t,e){if(void 0===t)throw new i.TreeError("Cannot delete undefined key.");var r=this.avl.delete(t,e);r&&(this.avl=r)},t.prototype.search=function(t){if(void 0===t)throw new i.TreeError("Cannot search undefined key.");return this.avl.search(t)},t.prototype.betweenBounds=function(t){return this.avl.betweenBounds(t)},t.prototype.executeOnEveryNode=function(t){this.avl.executeOnEveryNode(t)},t}();e.AVLTree=n;var o=function(){function t(t){if(this.parent=null,this.left=null,this.right=null,null!=t.initial){if(void 0===t.initial.key||void 0===t.initial.value)throw new i.TreeError("If initial value is provided key and value cannot be undefined");this.key=t.initial.key,this.data=[t.initial.value],this.height=1}else this.key=void 0,this.data=[],this.height=null;this.unique=null!=t.unique&&t.unique,this.compareKeys=t.compareKeys||i.defaultCompareKeys,this.checkValueEquality=t.checkValueEquality||i.defaultCheckValueEquality}return t.prototype.validateTree=function(){if(void 0!==this.key){if(null!=this.parent)throw new i.TreeError("The root shouldn't have a parent");this.validateNode()}},t.prototype.getNumberOfKeys=function(){if(void 0===this.key)return 0;var t=1;return this.left&&(t+=this.left.getNumberOfKeys()),this.right&&(t+=this.right.getNumberOfKeys()),t},t.prototype.getHeight=function(){return this.height},t.prototype.insert=function(t,e){var r=this;if(void 0===this.key)return this.key=t,this.data=[e],this.height=1,this;for(var n=[],o=this;;){var a=this.compareKeys(t,o.key);if(0===a){if(this.unique)throw new i.TreeError("Can't insert key '"+t+"', it violates the unique constraint",{key:String(t),errorType:"uniqueViolated"});var h=o.data.findIndex(function(t){return r.checkValueEquality(t,e)});return h>=0?o.data[h]=e:o.data.push(e),this}if(n.push(o),a<0){if(!o.left){n.push(o.createLeftChild({initial:{key:t,value:e}}));break}o=o.left}else{if(!o.right){n.push(o.createRightChild({initial:{key:t,value:e}}));break}o=o.right}}return this.rebalanceAlongPath(n)},t.prototype.delete=function(t,e){var r=this;if(void 0===this.key)return this;for(var i=[],n=this;;){if(!n)return this;var o=this.compareKeys(t,n.key);if(0===o)break;i.push(n),n=o<0?n.left:n.right}if(void 0!==e&&n.data.length>0&&(n.data=n.data.filter(function(t){return!r.checkValueEquality(t,e)}),n.data.length>0))return this;if(!n.left&&!n.right)return n===this?(n.key=void 0,n.data=[],n.height=null,this):(n.parent.left===n?n.parent.left=null:n.parent.right=null,this.rebalanceAlongPath(i));if(!n.left||!n.right){var a=n.left?n.left:n.right;return n===this?(a.parent=null,a):(n.parent.left===n?(n.parent.left=a,a.parent=n.parent):(n.parent.right=a,a.parent=n.parent),this.rebalanceAlongPath(i))}i.push(n);var h=n.left;if(!h.right)return n.key=h.key,n.data=h.data,n.left=h.left,h.left&&(h.left.parent=n),this.rebalanceAlongPath(i);for(;;){if(!h.right)break;i.push(h),h=h.right}return n.key=h.key,n.data=h.data,h.parent.right=h.left,h.left&&(h.left.parent=h.parent),this.rebalanceAlongPath(i)},t.prototype.search=function(t){if(void 0!==this.key)for(var e=this;;){var r=this.compareKeys(t,e.key);if(0===r)return e.data;if(r>0){if(!e.right)break;e=e.right}else{if(!e.left)break;e=e.left}}return[]},t.prototype.betweenBounds=function(t,e,r){if(void 0===this.key)return[];e=e||this.getLowerBoundMatcher(t),r=r||this.getUpperBoundMatcher(t);var n=e(this.key),o=r(this.key),a=[];return n&&this.left&&i.append(a,this.left.betweenBounds(t,e,r)),n&&o&&i.append(a,this.data),o&&this.right&&i.append(a,this.right.betweenBounds(t,e,r)),a},t.prototype.executeOnEveryNode=function(t){this.left&&this.left.executeOnEveryNode(t),t(this.key,this.data),this.right&&this.right.executeOnEveryNode(t)},t.prototype.getLowerBoundMatcher=function(t){var e=this;if(null==t.$gt&&null==t.$gte)return function(){return!0};if(null!=t.$gt&&null!=t.$gte){var r=this.compareKeys(t.$gte,t.$gt);return 0===r?function(r){return e.compareKeys(r,t.$gt)>0}:r>0?function(r){return e.compareKeys(r,t.$gte)>=0}:function(r){return e.compareKeys(r,t.$gt)>0}}return null!=t.$gt?function(r){return e.compareKeys(r,t.$gt)>0}:function(r){return e.compareKeys(r,t.$gte)>=0}},t.prototype.getUpperBoundMatcher=function(t){var e=this;if(null==t.$lt&&null==t.$lte)return function(){return!0};if(null!=t.$lt&&null!=t.$lte){var r=this.compareKeys(t.$lte,t.$lt);return 0===r?function(r){return e.compareKeys(r,t.$lt)<0}:r>0?function(r){return e.compareKeys(r,t.$lt)<0}:function(r){return e.compareKeys(r,t.$lte)<=0}}return null!=t.$lt?function(r){return e.compareKeys(r,t.$lt)<0}:function(r){return e.compareKeys(r,t.$lte)<=0}},t.prototype.rebalanceAlongPath=function(t){if(void 0===this.key)return this.height=null,this;for(var e,r=this,i=t.length-1;i>=0;--i){var n=t[i];n.height=1+Math.max(n.left?n.left.height:0,n.right?n.right.height:0),n.balanceFactor()>1&&(e=n.rightTooSmall(),0===i&&(r=e)),n.balanceFactor()<-1&&(e=n.leftTooSmall(),0===i&&(r=e))}return r},t.prototype.rightTooSmall=function(){return this.balanceFactor()<=1?this:(this.left.balanceFactor()<0&&this.left.leftRotation(),this.rightRotation())},t.prototype.leftTooSmall=function(){return this.balanceFactor()>=-1?this:(this.right.balanceFactor()>0&&this.right.rightRotation(),this.leftRotation())},t.prototype.rightRotation=function(){if(!this.left)return this;var t=this,e=this.left,r=e.right;t.parent?(e.parent=t.parent,t.parent.left===t?t.parent.left=e:t.parent.right=e):e.parent=null,e.right=t,t.parent=e,t.left=r,r&&(r.parent=t);var i=e.left?e.left.height:0,n=r?r.height:0,o=t.right?t.right.height:0;return t.height=Math.max(n,o)+1,e.height=Math.max(i,t.height)+1,e},t.prototype.leftRotation=function(){if(!this.right)return this;var t=this,e=this.right,r=e.left;t.parent?(e.parent=t.parent,t.parent.left===t?t.parent.left=e:t.parent.right=e):e.parent=null,e.left=t,t.parent=e,t.right=r,r&&(r.parent=t);var i=t.left?t.left.height:0,n=r?r.height:0,o=e.right?e.right.height:0;return t.height=Math.max(i,n)+1,e.height=Math.max(o,t.height)+1,e},t.prototype.validateNode=function(){var t=this;if(this.left){if(this.left.parent!==this)throw new i.TreeError("Parent pointer broken for key "+this.key);if(null==this.left.height)throw new i.TreeError("Undefined height for node '"+this.left.key+"'");this.left.executeOnEveryNode(function(e){if(t.compareKeys(e,t.key)>=0)throw new i.TreeError("Tree with root '"+t.key+"' is not a binary search tree")})}if(this.right){if(this.right.parent!==this)throw new i.TreeError("Parent pointer broken for key "+this.key);if(null==this.right.height)throw new i.TreeError("Undefined height for node '"+this.left.key+"'");this.right.executeOnEveryNode(function(e){if(t.compareKeys(e,t.key)<=0)throw new i.TreeError("Tree with root '"+t.key+"' is not a binary search tree")})}if(null==this.height)throw new i.TreeError("Undefined height for node '"+this.left.key+"'");var e=this.left?this.left.height:0,r=this.right?this.right.height:0;if(this.height!==1+Math.max(e,r))throw new i.TreeError("Height constraint failed for node '"+this.key+"'");if(Math.abs(this.balanceFactor())>1)throw new i.TreeError("Tree is unbalanced at node '"+this.key+"'");this.left&&this.left.validateNode(),this.right&&this.right.validateNode()},t.prototype.balanceFactor=function(){return(this.left?this.left.height:0)-(this.right?this.right.height:0)},t.prototype.createLeftChild=function(t){return this.left=this.createSimilar(t),this.left.parent=this,this.left},t.prototype.createRightChild=function(t){return this.right=this.createSimilar(t),this.right.parent=this,this.right},t.prototype.createSimilar=function(e){return e.unique=this.unique,e.compareKeys=this.compareKeys,e.checkValueEquality=this.checkValueEquality,new t(e)},t}()}])});